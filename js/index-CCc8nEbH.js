var K=(e,t,n)=>new Promise((s,o)=>{var i=u=>{try{c(n.next(u))}catch(p){o(p)}},r=u=>{try{c(n.throw(u))}catch(p){o(p)}},c=u=>u.done?s(u.value):Promise.resolve(u.value).then(i,r);c((n=n.apply(e,t)).next())});import{r as _,R as h,d as Bt,j as E}from"./index-7WbT3z16.js";import{u as Ft,m as z,w as H}from"./with-default-props-kKbqWDQo.js";import{a as kt}from"./attach-properties-to-component-CxYBDbn1.js";import{c as U}from"./tslib.es6-stJkEJF-.js";import{d as $t,u as ut,a as Kt,t as nt,f as st,I as Ut,b as Ht,r as Gt}from"./index.data-PxaZs5t4.js";import{u as Vt,a as Yt,c as Wt,w as ct,M as Xt,d as zt,S as Zt,r as Jt,e as qt}from"./books.store-BFuBvAOc.js";import{S as Qt,u as te}from"./safe-area-avR6jzj2.js";import{u as ee,T as ne}from"./index-BvMobb26.js";import{i as se,d as ot,b as oe,g as ie}from"./useEffectWithTarget-8LChVJPK.js";var pt=se&&("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch);function re(e,t,n){var s=n===void 0?{}:n,o=s.delay,i=o===void 0?300:o,r=s.moveThreshold,c=s.onClick,u=s.onLongPressEnd,p=ot(e),a=ot(c),f=ot(u),l=_.useRef(),d=_.useRef(!1),v=_.useRef({x:0,y:0}),T=!!(r!=null&&r.x&&r.x>0||r!=null&&r.y&&r.y>0);oe(function(){var g=ie(t);if(!(g!=null&&g.addEventListener))return;var w=function(b){var L=M(b),P=L.clientX,S=L.clientY,J=Math.abs(P-v.current.x),q=Math.abs(S-v.current.y);return!!(r!=null&&r.x&&J>r.x||r!=null&&r.y&&q>r.y)};function M(b){return"TouchEvent"in window&&b instanceof TouchEvent?{clientX:b.touches[0].clientX,clientY:b.touches[0].clientY}:b instanceof MouseEvent?{clientX:b.clientX,clientY:b.clientY}:{clientX:0,clientY:0}}var O=function(b){if(T){var L=M(b),P=L.clientX,S=L.clientY;v.current.x=P,v.current.y=S}l.current=setTimeout(function(){p.current(b),d.current=!0},i)},j=function(b){l.current&&w(b)&&(clearTimeout(l.current),l.current=void 0)},D=function(b,L){var P;L===void 0&&(L=!1),l.current&&clearTimeout(l.current),d.current&&((P=f.current)===null||P===void 0||P.call(f,b)),L&&!d.current&&a.current&&a.current(b),d.current=!1},m=function(b){return D(b,!0)};return pt?(g.addEventListener("touchstart",O),g.addEventListener("touchend",m),T&&g.addEventListener("touchmove",j)):(g.addEventListener("mousedown",O),g.addEventListener("mouseup",m),g.addEventListener("mouseleave",D),T&&g.addEventListener("mousemove",j)),function(){l.current&&(clearTimeout(l.current),d.current=!1),pt?(g.removeEventListener("touchstart",O),g.removeEventListener("touchend",m),T&&g.removeEventListener("touchmove",j)):(g.removeEventListener("mousedown",O),g.removeEventListener("mouseup",m),g.removeEventListener("mouseleave",D),T&&g.removeEventListener("mousemove",j))}},[],t)}function ae(e){return _.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),_.createElement("g",{id:"AddOutline-AddOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},_.createElement("g",{id:"AddOutline-add"},_.createElement("rect",{id:"AddOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),_.createElement("path",{d:"M25.1,6.5 C25.3209139,6.5 25.5,6.6790861 25.5,6.9 L25.5,22.5 L41.1,22.5 C41.3209139,22.5 41.5,22.6790861 41.5,22.9 L41.5,25.1 C41.5,25.3209139 41.3209139,25.5 41.1,25.5 L25.5,25.5 L25.5,41.1 C25.5,41.3209139 25.3209139,41.5 25.1,41.5 L22.9,41.5 C22.6790861,41.5 22.5,41.3209139 22.5,41.1 L22.5,25.5 L6.9,25.5 C6.6790861,25.5 6.5,25.3209139 6.5,25.1 L6.5,22.9 C6.5,22.6790861 6.6790861,22.5 6.9,22.5 L22.5,22.5 L22.5,6.9 C22.5,6.6790861 22.6790861,6.5 22.9,6.5 L25.1,6.5 Z",id:"AddOutline-路径",fill:"currentColor",fillRule:"nonzero"}))))}function ce(e,t,n){return Math.max(t,Math.min(e,n))}const A={toVector(e,t){return e===void 0&&(e=t),Array.isArray(e)?e:[e,e]},add(e,t){return[e[0]+t[0],e[1]+t[1]]},sub(e,t){return[e[0]-t[0],e[1]-t[1]]},addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function ht(e,t,n){return t===0||Math.abs(t)===1/0?Math.pow(e,n*5):e*t*n/(t+n*e)}function mt(e,t,n,s=.15){return s===0?ce(e,t,n):e<t?-ht(t-e,n-t,s)+t:e>n?+ht(e-n,n-t,s)+n:e}function le(e,[t,n],[s,o]){const[[i,r],[c,u]]=e;return[mt(t,i,r,s),mt(n,c,u,o)]}function ue(e,t){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function de(e){var t=ue(e,"string");return typeof t=="symbol"?t:String(t)}function k(e,t,n){return t=de(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?gt(Object(n),!0).forEach(function(s){k(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gt(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}const Ct={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function vt(e){return e?e[0].toUpperCase()+e.slice(1):""}const fe=["enter","leave"];function pe(e=!1,t){return e&&!fe.includes(t)}function he(e,t="",n=!1){const s=Ct[e],o=s&&s[t]||t;return"on"+vt(e)+vt(o)+(pe(n,o)?"Capture":"")}const me=["gotpointercapture","lostpointercapture"];function ge(e){let t=e.substring(2).toLowerCase();const n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));const s=me.includes(t)?"capturecapture":"capture",o=!!~t.indexOf(s);return o&&(t=t.replace("capture","")),{device:t,capture:o,passive:n}}function ve(e,t=""){const n=Ct[e],s=n&&n[t]||t;return e+s}function Z(e){return"touches"in e}function It(e){return Z(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function ye(e){return Array.from(e.touches).filter(t=>{var n,s;return t.target===e.currentTarget||((n=e.currentTarget)===null||n===void 0||(s=n.contains)===null||s===void 0?void 0:s.call(n,t.target))})}function be(e){return e.type==="touchend"||e.type==="touchcancel"?e.changedTouches:e.targetTouches}function Ot(e){return Z(e)?be(e)[0]:e}function _e(e){return ye(e).map(t=>t.identifier)}function it(e){const t=Ot(e);return Z(e)?t.identifier:t.pointerId}function yt(e){const t=Ot(e);return[t.clientX,t.clientY]}function Ee(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:n,altKey:s,metaKey:o,ctrlKey:i}=e;Object.assign(t,{shiftKey:n,altKey:s,metaKey:o,ctrlKey:i})}return t}function X(e,...t){return typeof e=="function"?e(...t):e}function Te(){}function Ae(...e){return e.length===0?Te:e.length===1?e[0]:function(){let t;for(const n of e)t=n.apply(this,arguments)||t;return t}}function bt(e,t){return Object.assign({},t,e||{})}const we=32;class xe{constructor(t,n,s){this.ctrl=t,this.args=n,this.key=s,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(t){this.ctrl.state[this.key]=t}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:t,shared:n,ingKey:s,args:o}=this;n[s]=t._active=t.active=t._blocked=t._force=!1,t._step=[!1,!1],t.intentional=!1,t._movement=[0,0],t._distance=[0,0],t._direction=[0,0],t._delta=[0,0],t._bounds=[[-1/0,1/0],[-1/0,1/0]],t.args=o,t.axis=void 0,t.memo=void 0,t.elapsedTime=t.timeDelta=0,t.direction=[0,0],t.distance=[0,0],t.overflow=[0,0],t._movementBound=[!1,!1],t.velocity=[0,0],t.movement=[0,0],t.delta=[0,0],t.timeStamp=0}start(t){const n=this.state,s=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=t.target,n.currentTarget=t.currentTarget,n.lastOffset=s.from?X(s.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=t.timeStamp)}computeValues(t){const n=this.state;n._values=t,n.values=this.config.transform(t)}computeInitial(){const t=this.state;t._initial=t._values,t.initial=t.values}compute(t){const{state:n,config:s,shared:o}=this;n.args=this.args;let i=0;if(t&&(n.event=t,s.preventDefault&&t.cancelable&&n.event.preventDefault(),n.type=t.type,o.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,o.locked=!!document.pointerLockElement,Object.assign(o,Ee(t)),o.down=o.pressed=o.buttons%2===1||o.touches>0,i=t.timeStamp-n.timeStamp,n.timeStamp=t.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const m=n._delta.map(Math.abs);A.addTo(n._distance,m)}this.axisIntent&&this.axisIntent(t);const[r,c]=n._movement,[u,p]=s.threshold,{_step:a,values:f}=n;if(s.hasCustomTransform?(a[0]===!1&&(a[0]=Math.abs(r)>=u&&f[0]),a[1]===!1&&(a[1]=Math.abs(c)>=p&&f[1])):(a[0]===!1&&(a[0]=Math.abs(r)>=u&&Math.sign(r)*u),a[1]===!1&&(a[1]=Math.abs(c)>=p&&Math.sign(c)*p)),n.intentional=a[0]!==!1||a[1]!==!1,!n.intentional)return;const l=[0,0];if(s.hasCustomTransform){const[m,b]=f;l[0]=a[0]!==!1?m-a[0]:0,l[1]=a[1]!==!1?b-a[1]:0}else l[0]=a[0]!==!1?r-a[0]:0,l[1]=a[1]!==!1?c-a[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(l);const d=n.offset,v=n._active&&!n._blocked||n.active;v&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=o[this.ingKey]=n._active,t&&(n.first&&("bounds"in s&&(n._bounds=X(s.bounds,n)),this.setup&&this.setup()),n.movement=l,this.computeOffset()));const[T,g]=n.offset,[[w,M],[O,j]]=n._bounds;n.overflow=[T<w?-1:T>M?1:0,g<O?-1:g>j?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const D=n._active?s.rubberband||[0,0]:[0,0];if(n.offset=le(n._bounds,n.offset,D),n.delta=A.sub(n.offset,d),this.computeMovement(),v&&(!n.last||i>we)){n.delta=A.sub(n.offset,d);const m=n.delta.map(Math.abs);A.addTo(n.distance,m),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&i>0&&(n.velocity=[m[0]/i,m[1]/i],n.timeDelta=i)}}emit(){const t=this.state,n=this.shared,s=this.config;if(t._active||this.clean(),(t._blocked||!t.intentional)&&!t._force&&!s.triggerAllEvents)return;const o=this.handler(y(y(y({},n),t),{},{[this.aliasKey]:t.values}));o!==void 0&&(t.memo=o)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function Se([e,t],n){const s=Math.abs(e),o=Math.abs(t);if(s>o&&s>n)return"x";if(o>s&&o>n)return"y"}class ke extends xe{constructor(...t){super(...t),k(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=A.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=A.sub(this.state.offset,this.state.lastOffset)}axisIntent(t){const n=this.state,s=this.config;if(!n.axis&&t){const o=typeof s.axisThreshold=="object"?s.axisThreshold[It(t)]:s.axisThreshold;n.axis=Se(n._movement,o)}n._blocked=(s.lockDirection||!!s.axis)&&!n.axis||!!s.axis&&s.axis!==n.axis}restrictToAxis(t){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":t[1]=0;break;case"y":t[0]=0;break}}}const Ce=e=>e,_t=.15,Rt={enabled(e=!0){return e},eventOptions(e,t,n){return y(y({},n.shared.eventOptions),e)},preventDefault(e=!1){return e},triggerAllEvents(e=!1){return e},rubberband(e=0){switch(e){case!0:return[_t,_t];case!1:return[0,0];default:return A.toVector(e)}},from(e){if(typeof e=="function")return e;if(e!=null)return A.toVector(e)},transform(e,t,n){const s=e||n.shared.transform;return this.hasCustomTransform=!!s,s||Ce},threshold(e){return A.toVector(e,0)}},Ie=0,G=y(y({},Rt),{},{axis(e,t,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(e=Ie){return e},bounds(e={}){if(typeof e=="function")return i=>G.bounds(e(i));if("current"in e)return()=>e.current;if(typeof HTMLElement=="function"&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:n=1/0,top:s=-1/0,bottom:o=1/0}=e;return[[t,n],[s,o]]}}),Et={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]};class Oe extends ke{constructor(...t){super(...t),k(this,"ingKey","dragging")}reset(){super.reset();const t=this.state;t._pointerId=void 0,t._pointerActive=!1,t._keyboardActive=!1,t._preventScroll=!1,t._delayed=!1,t.swipe=[0,0],t.tap=!1,t.canceled=!1,t.cancel=this.cancel.bind(this)}setup(){const t=this.state;if(t._bounds instanceof HTMLElement){const n=t._bounds.getBoundingClientRect(),s=t.currentTarget.getBoundingClientRect(),o={left:n.left-s.left+t.offset[0],right:n.right-s.right+t.offset[0],top:n.top-s.top+t.offset[1],bottom:n.bottom-s.bottom+t.offset[1]};t._bounds=G.bounds(o)}}cancel(){const t=this.state;t.canceled||(t.canceled=!0,t._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(t){const n=this.config,s=this.state;if(t.buttons!=null&&(Array.isArray(n.pointerButtons)?!n.pointerButtons.includes(t.buttons):n.pointerButtons!==-1&&n.pointerButtons!==t.buttons))return;const o=this.ctrl.setEventIds(t);n.pointerCapture&&t.target.setPointerCapture(t.pointerId),!(o&&o.size>1&&s._pointerActive)&&(this.start(t),this.setupPointer(t),s._pointerId=it(t),s._pointerActive=!0,this.computeValues(yt(t)),this.computeInitial(),n.preventScrollAxis&&It(t)!=="mouse"?(s._active=!1,this.setupScrollPrevention(t)):n.delay>0?(this.setupDelayTrigger(t),n.triggerAllEvents&&(this.compute(t),this.emit())):this.startPointerDrag(t))}startPointerDrag(t){const n=this.state;n._active=!0,n._preventScroll=!0,n._delayed=!1,this.compute(t),this.emit()}pointerMove(t){const n=this.state,s=this.config;if(!n._pointerActive)return;const o=it(t);if(n._pointerId!==void 0&&o!==n._pointerId)return;const i=yt(t);if(document.pointerLockElement===t.target?n._delta=[t.movementX,t.movementY]:(n._delta=A.sub(i,n._values),this.computeValues(i)),A.addTo(n._movement,n._delta),this.compute(t),n._delayed&&n.intentional){this.timeoutStore.remove("dragDelay"),n.active=!1,this.startPointerDrag(t);return}if(s.preventScrollAxis&&!n._preventScroll)if(n.axis)if(n.axis===s.preventScrollAxis||s.preventScrollAxis==="xy"){n._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(t);return}else return;this.emit()}pointerUp(t){this.ctrl.setEventIds(t);try{this.config.pointerCapture&&t.target.hasPointerCapture(t.pointerId)&&t.target.releasePointerCapture(t.pointerId)}catch(c){}const n=this.state,s=this.config;if(!n._active||!n._pointerActive)return;const o=it(t);if(n._pointerId!==void 0&&o!==n._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(t);const[i,r]=n._distance;if(n.tap=i<=s.tapsThreshold&&r<=s.tapsThreshold,n.tap&&s.filterTaps)n._force=!0;else{const[c,u]=n._delta,[p,a]=n._movement,[f,l]=s.swipe.velocity,[d,v]=s.swipe.distance,T=s.swipe.duration;if(n.elapsedTime<T){const g=Math.abs(c/n.timeDelta),w=Math.abs(u/n.timeDelta);g>f&&Math.abs(p)>d&&(n.swipe[0]=Math.sign(c)),w>l&&Math.abs(a)>v&&(n.swipe[1]=Math.sign(u))}}this.emit()}pointerClick(t){!this.state.tap&&t.detail>0&&(t.preventDefault(),t.stopPropagation())}setupPointer(t){const n=this.config,s=n.device;n.pointerLock&&t.currentTarget.requestPointerLock(),n.pointerCapture||(this.eventStore.add(this.sharedConfig.window,s,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,s,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,s,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(t){this.state._preventScroll&&t.cancelable&&t.preventDefault()}setupScrollPrevention(t){this.state._preventScroll=!1,Re(t);const n=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",n),this.eventStore.add(this.sharedConfig.window,"touch","cancel",n),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,t)}setupDelayTrigger(t){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(t)},this.config.delay)}keyDown(t){const n=Et[t.key];if(n){const s=this.state,o=t.shiftKey?10:t.altKey?.1:1;this.start(t),s._delta=n(this.config.keyboardDisplacement,o),s._keyboardActive=!0,A.addTo(s._movement,s._delta),this.compute(t),this.emit()}}keyUp(t){t.key in Et&&(this.state._keyboardActive=!1,this.setActive(),this.compute(t),this.emit())}bind(t){const n=this.config.device;t(n,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(t(n,"change",this.pointerMove.bind(this)),t(n,"end",this.pointerUp.bind(this)),t(n,"cancel",this.pointerUp.bind(this)),t("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(t("key","down",this.keyDown.bind(this)),t("key","up",this.keyUp.bind(this))),this.config.filterTaps&&t("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function Re(e){"persist"in e&&typeof e.persist=="function"&&e.persist()}const V=typeof window!="undefined"&&window.document&&window.document.createElement;function Dt(){return V&&"ontouchstart"in window}function De(){return Dt()||V&&window.navigator.maxTouchPoints>1}function Le(){return V&&"onpointerdown"in window}function Pe(){return V&&"exitPointerLock"in window.document}function Me(){try{return"constructor"in GestureEvent}catch(e){return!1}}const R={isBrowser:V,gesture:Me(),touch:Dt(),touchscreen:De(),pointer:Le(),pointerLock:Pe()},Ne=250,je=180,Be=.5,Fe=50,$e=250,Ke=10,Tt={mouse:0,touch:0,pen:8},Ue=y(y({},G),{},{device(e,t,{pointer:{touch:n=!1,lock:s=!1,mouse:o=!1}={}}){return this.pointerLock=s&&R.pointerLock,R.touch&&n?"touch":this.pointerLock?"mouse":R.pointer&&!o?"pointer":R.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&e?Ne:void 0,!(!R.touchscreen||n===!1))return e||(n!==void 0?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:s=1,keys:o=!0}={}}){return this.pointerButtons=s,this.keys=o,!this.pointerLock&&this.device==="pointer"&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:s=3,axis:o=void 0}){const i=A.toVector(e,n?s:o?1:0);return this.filterTaps=n,this.tapsThreshold=s,i},swipe({velocity:e=Be,distance:t=Fe,duration:n=$e}={}){return{velocity:this.transform(A.toVector(e)),distance:this.transform(A.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return je;case!1:return 0;default:return e}},axisThreshold(e){return e?y(y({},Tt),e):Tt},keyboardDisplacement(e=Ke){return e}});y(y({},Rt),{},{device(e,t,{shared:n,pointer:{touch:s=!1}={}}){if(n.target&&!R.touch&&R.gesture)return"gesture";if(R.touch&&s)return"touch";if(R.touchscreen){if(R.pointer)return"pointer";if(R.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:s={}}){const o=r=>{const c=bt(X(n,r),{min:-1/0,max:1/0});return[c.min,c.max]},i=r=>{const c=bt(X(s,r),{min:-1/0,max:1/0});return[c.min,c.max]};return typeof n!="function"&&typeof s!="function"?[o(),i()]:r=>[o(r),i(r)]},threshold(e,t,n){return this.lockDirection=n.axis==="lock",A.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey(e){return e===void 0?"ctrlKey":e},pinchOnWheel(e=!0){return e}});y(y({},G),{},{mouseOnly:(e=!0)=>e});y(y({},G),{},{mouseOnly:(e=!0)=>e});const Lt=new Map,lt=new Map;function He(e){Lt.set(e.key,e.engine),lt.set(e.key,e.resolver)}const Ge={key:"drag",engine:Oe,resolver:Ue};function Ve(e,t){if(e==null)return{};var n={},s=Object.keys(e),o,i;for(i=0;i<s.length;i++)o=s[i],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}function Ye(e,t){if(e==null)return{};var n=Ve(e,t),s,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)s=i[o],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}const We={target(e){if(e)return()=>"current"in e?e.current:e},enabled(e=!0){return e},window(e=R.isBrowser?window:void 0){return e},eventOptions({passive:e=!0,capture:t=!1}={}){return{passive:e,capture:t}},transform(e){return e}},Xe=["target","eventOptions","window","enabled","transform"];function W(e={},t){const n={};for(const[s,o]of Object.entries(t))switch(typeof o){case"function":n[s]=o.call(n,e[s],s,e);break;case"object":n[s]=W(e[s],o);break;case"boolean":o&&(n[s]=e[s]);break}return n}function ze(e,t,n={}){const s=e,{target:o,eventOptions:i,window:r,enabled:c,transform:u}=s,p=Ye(s,Xe);if(n.shared=W({target:o,eventOptions:i,window:r,enabled:c,transform:u},We),t){const a=lt.get(t);n[t]=W(y({shared:n.shared},p),a)}else for(const a in p){const f=lt.get(a);f&&(n[a]=W(y({shared:n.shared},p[a]),f))}return n}class Pt{constructor(t,n){k(this,"_listeners",new Set),this._ctrl=t,this._gestureKey=n}add(t,n,s,o,i){const r=this._listeners,c=ve(n,s),u=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},p=y(y({},u),i);t.addEventListener(c,o,p);const a=()=>{t.removeEventListener(c,o,p),r.delete(a)};return r.add(a),a}clean(){this._listeners.forEach(t=>t()),this._listeners.clear()}}class Ze{constructor(){k(this,"_timeouts",new Map)}add(t,n,s=140,...o){this.remove(t),this._timeouts.set(t,window.setTimeout(n,s,...o))}remove(t){const n=this._timeouts.get(t);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(t=>void window.clearTimeout(t)),this._timeouts.clear()}}class Je{constructor(t){k(this,"gestures",new Set),k(this,"_targetEventStore",new Pt(this)),k(this,"gestureEventStores",{}),k(this,"gestureTimeoutStores",{}),k(this,"handlers",{}),k(this,"config",{}),k(this,"pointerIds",new Set),k(this,"touchIds",new Set),k(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),qe(this,t)}setEventIds(t){if(Z(t))return this.touchIds=new Set(_e(t)),this.touchIds;if("pointerId"in t)return t.type==="pointerup"||t.type==="pointercancel"?this.pointerIds.delete(t.pointerId):t.type==="pointerdown"&&this.pointerIds.add(t.pointerId),this.pointerIds}applyHandlers(t,n){this.handlers=t,this.nativeHandlers=n}applyConfig(t,n){this.config=ze(t,n,this.config)}clean(){this._targetEventStore.clean();for(const t of this.gestures)this.gestureEventStores[t].clean(),this.gestureTimeoutStores[t].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...t){const n=this.config.shared,s={};let o;if(!(n.target&&(o=n.target(),!o))){if(n.enabled){for(const r of this.gestures){const c=this.config[r],u=At(s,c.eventOptions,!!o);if(c.enabled){const p=Lt.get(r);new p(this,t,r).bind(u)}}const i=At(s,n.eventOptions,!!o);for(const r in this.nativeHandlers)i(r,"",c=>this.nativeHandlers[r](y(y({},this.state.shared),{},{event:c,args:t})),void 0,!0)}for(const i in s)s[i]=Ae(...s[i]);if(!o)return s;for(const i in s){const{device:r,capture:c,passive:u}=ge(i);this._targetEventStore.add(o,r,"",s[i],{capture:c,passive:u})}}}}function F(e,t){e.gestures.add(t),e.gestureEventStores[t]=new Pt(e,t),e.gestureTimeoutStores[t]=new Ze}function qe(e,t){t.drag&&F(e,"drag"),t.wheel&&F(e,"wheel"),t.scroll&&F(e,"scroll"),t.move&&F(e,"move"),t.pinch&&F(e,"pinch"),t.hover&&F(e,"hover")}const At=(e,t,n)=>(s,o,i,r={},c=!1)=>{var u,p;const a=(u=r.capture)!==null&&u!==void 0?u:t.capture,f=(p=r.passive)!==null&&p!==void 0?p:t.passive;let l=c?s:he(s,o,a);n&&f&&(l+="Passive"),e[l]=e[l]||[],e[l].push(i)};function Qe(e,t={},n,s){const o=h.useMemo(()=>new Je(e),[]);if(o.applyHandlers(e,s),o.applyConfig(t,n),h.useEffect(o.effect.bind(o)),h.useEffect(()=>o.clean.bind(o),[]),t.target===void 0)return o.bind.bind(o)}function tn(e,t){return He(Ge),Qe({drag:e},t||{},"drag")}const Y="adm-popup",en=Object.assign(Object.assign({},$t),{closeOnSwipe:!1,position:"bottom"}),nn=e=>{const{locale:t,popup:n={}}=Ft(),s=z(en,n,e),o=U(`${Y}-body`,s.bodyClassName,`${Y}-body-position-${s.position}`),[i,r]=_.useState(s.visible),c=_.useRef(null);Vt(c,s.disableBodyScroll&&i?"strict":!1),ut(()=>{s.visible&&r(!0)},[s.visible]);const u=Yt(),{percent:p}=Wt({percent:s.visible?0:100,config:{precision:.1,mass:.4,tension:300,friction:30},onRest:()=>{var d,v;u.current||(r(s.visible),s.visible?(d=s.afterShow)===null||d===void 0||d.call(s):(v=s.afterClose)===null||v===void 0||v.call(s))}}),a=tn(({swipe:[,d]})=>{var v;s.closeOnSwipe&&(d===1&&s.position==="bottom"||d===-1&&s.position==="top")&&((v=s.onClose)===null||v===void 0||v.call(s))},{axis:"y",enabled:["top","bottom"].includes(s.position)}),f=Kt(i&&s.visible),l=ct(s.stopPropagation,H(s,h.createElement("div",Object.assign({className:Y,onClick:s.onClick,style:{display:i?void 0:"none",touchAction:["top","bottom"].includes(s.position)?"none":"auto"}},a()),s.mask&&h.createElement(Xt,{visible:f,forceRender:s.forceRender,destroyOnClose:s.destroyOnClose,onMaskClick:d=>{var v,T;(v=s.onMaskClick)===null||v===void 0||v.call(s,d),s.closeOnMaskClick&&((T=s.onClose)===null||T===void 0||T.call(s))},className:s.maskClassName,style:s.maskStyle,disableBodyScroll:!1,stopPropagation:s.stopPropagation}),h.createElement(zt.div,{className:o,style:Object.assign(Object.assign({},s.bodyStyle),{pointerEvents:p.to(d=>d===0?"unset":"none"),transform:p.to(d=>s.position==="bottom"?`translate(0, ${d}%)`:s.position==="top"?`translate(0, -${d}%)`:s.position==="left"?`translate(-${d}%, 0)`:s.position==="right"?`translate(${d}%, 0)`:"none")}),ref:c},s.showCloseButton&&h.createElement("a",{className:U(`${Y}-close-icon`,"adm-plain-anchor"),onClick:()=>{var d;(d=s.onClose)===null||d===void 0||d.call(s)},role:"button","aria-label":t.common.close},s.closeIcon),s.children))));return h.createElement(Zt,{active:i,forceRender:s.forceRender,destroyOnClose:s.destroyOnClose},Jt(s.getContainer,l))},x="adm-action-sheet",sn={visible:!1,actions:[],cancelText:"",closeOnAction:!1,closeOnMaskClick:!0,safeArea:!0,destroyOnClose:!1,forceRender:!1},Mt=e=>{const t=z(sn,e),{styles:n}=t;return h.createElement(nn,{visible:t.visible,onMaskClick:()=>{var s,o;(s=t.onMaskClick)===null||s===void 0||s.call(t),t.closeOnMaskClick&&((o=t.onClose)===null||o===void 0||o.call(t))},afterClose:t.afterClose,className:U(`${x}-popup`,t.popupClassName),style:t.popupStyle,getContainer:t.getContainer,destroyOnClose:t.destroyOnClose,forceRender:t.forceRender,bodyStyle:n==null?void 0:n.body,maskStyle:n==null?void 0:n.mask},H(t,h.createElement("div",{className:x},t.extra&&h.createElement("div",{className:`${x}-extra`},t.extra),h.createElement("div",{className:`${x}-button-list`},t.actions.map((s,o)=>h.createElement("div",{key:s.key,className:`${x}-button-item-wrapper`},h.createElement("a",{className:U("adm-plain-anchor",`${x}-button-item`,{[`${x}-button-item-danger`]:s.danger,[`${x}-button-item-disabled`]:s.disabled,[`${x}-button-item-bold`]:s.bold}),onClick:()=>{var i,r,c;(i=s.onClick)===null||i===void 0||i.call(s),(r=t.onAction)===null||r===void 0||r.call(t,s,o),t.closeOnAction&&((c=t.onClose)===null||c===void 0||c.call(t))},role:"option","aria-disabled":s.disabled},h.createElement("div",{className:`${x}-button-item-name`},s.text),s.description&&h.createElement("div",{className:`${x}-button-item-description`},s.description))))),t.cancelText&&h.createElement("div",{className:`${x}-cancel`,role:"option","aria-label":t.cancelText},h.createElement("div",{className:`${x}-button-item-wrapper`},h.createElement("a",{className:U("adm-plain-anchor",`${x}-button-item`),onClick:t.onClose},h.createElement("div",{className:`${x}-button-item-name`},t.cancelText)))),t.safeArea&&h.createElement(Qt,{position:"bottom"}))))};function on(e){return qt(h.createElement(Mt,Object.assign({},e)))}const rn=kt(Mt,{show:on});function an(e,t){const n=te(e);ut(()=>{const s=t.current;if(s)if(window.ResizeObserver){let o;const i=new ResizeObserver(()=>{o=window.requestAnimationFrame(()=>n(s))});return i.observe(s),()=>{window.cancelAnimationFrame(o),i.disconnect()}}else n(s)},[t])}var wt;(function(e){e[e.HIGH_SURROGATE_START=55296]="HIGH_SURROGATE_START",e[e.HIGH_SURROGATE_END=56319]="HIGH_SURROGATE_END",e[e.LOW_SURROGATE_START=56320]="LOW_SURROGATE_START",e[e.REGIONAL_INDICATOR_START=127462]="REGIONAL_INDICATOR_START",e[e.REGIONAL_INDICATOR_END=127487]="REGIONAL_INDICATOR_END",e[e.FITZPATRICK_MODIFIER_START=127995]="FITZPATRICK_MODIFIER_START",e[e.FITZPATRICK_MODIFIER_END=127999]="FITZPATRICK_MODIFIER_END",e[e.VARIATION_MODIFIER_START=65024]="VARIATION_MODIFIER_START",e[e.VARIATION_MODIFIER_END=65039]="VARIATION_MODIFIER_END",e[e.DIACRITICAL_MARKS_START=8400]="DIACRITICAL_MARKS_START",e[e.DIACRITICAL_MARKS_END=8447]="DIACRITICAL_MARKS_END",e[e.SUBDIVISION_INDICATOR_START=127988]="SUBDIVISION_INDICATOR_START",e[e.TAGS_START=917504]="TAGS_START",e[e.TAGS_END=917631]="TAGS_END",e[e.ZWJ=8205]="ZWJ"})(wt||(wt={}));const cn=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);var xt;function ln(e){if(typeof e!="string")throw new TypeError("string cannot be undefined or null");const t=[];let n=0,s=0;for(;n<e.length;)s+=un(n+s,e),vn(e[n+s])&&s++,hn(e[n+s])&&s++,mn(e[n+s])&&s++,yn(e[n+s])?s++:(t.push(e.substring(n,n+s)),n+=s,s=0);return t}function un(e,t){const n=t[e];if(!dn(n)||e===t.length-1)return 1;const s=n+t[e+1];let o=t.substring(e+2,e+5);return St(s)&&St(o)?4:fn(s)&&gn(o)?t.slice(e).indexOf(String.fromCodePoint(917631))+2:pn(o)?4:2}function dn(e){return e&&B(e[0].charCodeAt(0),55296,56319)}function St(e){return B(dt(e),127462,127487)}function fn(e){return B(dt(e),127988,127988)}function pn(e){return B(dt(e),127995,127999)}function hn(e){return typeof e=="string"&&B(e.charCodeAt(0),65024,65039)}function mn(e){return typeof e=="string"&&B(e.charCodeAt(0),8400,8447)}function gn(e){const t=e.codePointAt(0);return typeof e=="string"&&typeof t=="number"&&B(t,917504,917631)}function vn(e){return typeof e=="string"&&cn.includes(e.charCodeAt(0))}function yn(e){return typeof e=="string"&&e.charCodeAt(0)===8205}function dt(e){return(e.charCodeAt(0)-55296<<10)+(e.charCodeAt(1)-56320)+65536}function B(e,t,n){return e>=t&&e<=n}(function(e){e[e.unit_1=1]="unit_1",e[e.unit_2=2]="unit_2",e[e.unit_4=4]="unit_4"})(xt||(xt={}));const bn="adm-ellipsis",_n={direction:"end",rows:1,expandText:"",content:"",collapseText:"",stopPropagationForActionButtons:[],onContentClick:()=>{},defaultExpanded:!1},En=e=>{const t=z(_n,e),n=_.useRef(null),s=_.useRef(null),o=_.useRef(null),[i,r]=_.useState({}),[c,u]=_.useState(t.defaultExpanded),[p,a]=_.useState(!1),f=_.useMemo(()=>ln(t.content),[t.content]);function l(w,M){return f.slice(w,M).join("")}function d(){var w,M;const O=n.current;if(!O)return;const j=O.style.display;O.style.display="block";const D=window.getComputedStyle(O),m=document.createElement("div");Array.prototype.slice.apply(D).forEach(S=>{m.style.setProperty(S,D.getPropertyValue(S))}),O.style.display=j,m.style.height="auto",m.style.minHeight="auto",m.style.maxHeight="auto",m.style.textOverflow="clip",m.style.webkitLineClamp="unset",m.style.display="block";const L=rt(D.lineHeight),P=Math.floor(L*(t.rows+.5)+rt(D.paddingTop)+rt(D.paddingBottom));if(m.innerText=t.content,document.body.appendChild(m),m.offsetHeight<=P)a(!1);else{let $=function(C,I){if(I-C<=1)return t.direction==="end"?{leading:l(0,C)+"..."}:{tailing:"..."+l(I,S)};const N=Math.round((C+I)/2);return t.direction==="end"?m.innerHTML=l(0,N)+"..."+Q:m.innerHTML=Q+"..."+l(N,S),m.offsetHeight<=P?t.direction==="end"?$(N,I):$(C,N):t.direction==="end"?$(C,N):$(N,I)},tt=function(C,I){if(C[1]-C[0]<=1&&I[1]-I[0]<=1)return{leading:l(0,C[0])+"...",tailing:"..."+l(I[1],S)};const N=Math.floor((C[0]+C[1])/2),et=Math.ceil((I[0]+I[1])/2);return m.innerHTML=l(0,N)+"..."+Q+"..."+l(et,S),m.offsetHeight<=P?tt([N,C[1]],[I[0],et]):tt([C[0],N],[et,I[1]])};a(!0);const S=t.content.length,J=typeof t.collapseText=="string"?t.collapseText:(w=o.current)===null||w===void 0?void 0:w.innerHTML,q=typeof t.expandText=="string"?t.expandText:(M=s.current)===null||M===void 0?void 0:M.innerHTML,Q=c?J:q,ft=Math.floor((0+S)/2),jt=t.direction==="middle"?tt([0,ft],[ft,S]):$(0,S);r(jt)}document.body.removeChild(m)}an(d,n),ut(()=>{d()},[t.content,t.direction,t.rows,t.expandText,t.collapseText]);const v=!!t.expandText&&ct(t.stopPropagationForActionButtons,h.createElement("a",{ref:s,onClick:()=>{u(!0)}},t.expandText)),T=!!t.collapseText&&ct(t.stopPropagationForActionButtons,h.createElement("a",{ref:o,onClick:()=>{u(!1)}},t.collapseText)),g=()=>p?c?h.createElement(h.Fragment,null,t.content,T):h.createElement(h.Fragment,null,i.leading,v,i.tailing):t.content;return H(t,h.createElement("div",{ref:n,className:bn,onClick:w=>{w.target===w.currentTarget&&t.onContentClick(w)}},g()))};function rt(e){if(!e)return 0;const t=e.match(/^\d*(\.\d*)?/);return t?Number(t[0]):0}const Nt="adm-grid",Tn=e=>{const t={"--columns":e.columns.toString()},{gap:n}=e;return n!==void 0&&(Array.isArray(n)?(t["--gap-horizontal"]=nt(n[0]),t["--gap-vertical"]=nt(n[1])):t["--gap"]=nt(n)),H(e,h.createElement("div",{className:Nt,style:t},e.children))},An=e=>{const t=z({span:1},e),n={"--item-span":t.span};return H(t,h.createElement("div",{className:`${Nt}-item`,style:n,onClick:t.onClick},t.children))},at=kt(Tn,{Item:An}),wn=".pdf,.epub,.txt,.md";function Mn(){const[e,t]=_.useState([]),n=_.useRef(null),[s,o]=_.useState({visible:!1,name:""}),i=Bt();ee(()=>K(this,null,function*(){t((yield st())||[])}),[]);function r(a){return K(this,null,function*(){const{name:f}=a||{};f&&i(`/reader/book/${encodeURIComponent(f)}`)})}function c(a){return K(this,null,function*(){const[f]=a.target.files||[];a.target.value="",yield Ht(f),t((yield st())||[])})}function u(){return K(this,null,function*(){const{name:a}=s;yield Gt(a),t((yield st())||[]),o({visible:!1,name:""}),ne.show("删除成功")})}re(a=>{a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();let f=a.target;for(;f&&f!==n.current;){const{name:l}=f.dataset||{};if(l){o({visible:!0,name:l});break}f=f.parentNode}},n,{});const p=({visible:a,onClose:f,deleteBook:l})=>{const d=[{text:"修改",key:"edit"},{text:"删除",key:"delete",danger:!0,bold:!0,onClick:l}];return E.jsx(rn,{visible:a,actions:d,onClose:()=>f==null?void 0:f()})};return E.jsxs(E.Fragment,{children:[E.jsx(p,{visible:s.visible,onClose:()=>o({visible:!1,name:""}),deleteBook:u}),E.jsx("div",{ref:n,children:E.jsxs(at,{columns:3,gap:[0,24],children:[e.map((a,f)=>E.jsx(at.Item,{children:E.jsxs("div",{className:"flex flex-col justify-center items-center","data-name":a.name,children:[E.jsx("div",{className:"rd w-80% aspect-ratio-0.618 bg-#eee",onClick:()=>r(a),children:E.jsx(Ut,{src:a.img,width:"100%",height:"100%",fit:"fill"})}),E.jsx("div",{className:"mt-2 px-2",children:E.jsx(En,{direction:"end",content:a.name})})]})},f)),E.jsx(at.Item,{children:E.jsx("div",{className:"flex justify-center items-center ",children:E.jsxs("label",{htmlFor:"file",className:"flex justify-center items-center relative b-1 b-#eee rd w-80% aspect-ratio-0.618",children:[E.jsx(ae,{fontSize:32,color:"#999"}),E.jsx("input",{onInput:c,type:"file",accept:wn,className:"op-0 absolute top-0 left-0 w-full h-full"})]})})})]})})]})}export{Mn as default};
